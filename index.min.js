"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AccessibleSVG=void 0;class AccessibleSVG{constructor(v){this.pie=(s,a)=>{const e=(i,x,f)=>{const h=document.createElement("circle");let m="25";h.setAttribute("r",m+"%"),h.setAttribute("cx","50%"),h.setAttribute("cy","50%"),m=16;const p=2*Math.PI*m,g=p*(i/100),A=g+","+p;return h.style.strokeDasharray=A,h.style.stroke=x,h.style.strokeDashoffset=String(f),{element:h,value:g}},o=i=>{let x=0;return i.forEach(f=>{x+=f.percentage}),x},n=i=>{let x="This pie is contains: ";return i.forEach(f=>{x+=String(f.percentage+"% for "+f.title+" and it's colored "+f.color+". ")}),x};if(o(s)!==100){console.log("The percentages for the pie must add up to exactly 100%.");return}const l=this.createSVG(0,0,64,64);l.classList.add("asg-graph");let t=0;const c=l.querySelector("desc");c.innerText+=n(s);const r=[];if(s.forEach(i=>{const x=e(i.percentage,i.color,-t),f=document.createElement("title");f.setAttribute("role","tooltip"),f.innerText=i.title+": "+i.percentage+"%",t+=x.value,x.element.appendChild(f),r.push(x.element)}),l.classList.add("asg-pie"),this.options.animation==!0){let i=e("0","white",-t+.53096491487338).element;i.classList.add("asg-reveal"),i.style.animation="rotate "+this.options.duration+"s ease-in-out forwards reverse",i.style.transform="rotate(0deg) scale(1,-1)",i.style.transformOrigin="center",r.push(i),this.observe(this.type)}r.forEach(i=>{l.appendChild(i)}),this.type==="donut"&&(l.innerHTML+='<circle r="35%" cx="50%" cy="50%" style="fill:white;"></circle>',l.style.border="none"),this.addDataType(l,this.type),this.hook(a,l)},this.bar=(s,a)=>{const e=s.length,o=10,n=s.map(p=>p.value),d=Math.max(...n),l=o,t=30,c=e*t+o*e+l*2,r=c;let i=o+l;const x=this.createSVG(0,0,c+2*o,r+2*o);x.classList.add("asg-graph");const f=(p,g,A,u)=>{const y=document.createElement("rect");return y.setAttribute("x",String(p)),y.setAttribute("width",String(g)),y.setAttribute("height",String(A)),y.setAttribute("y",String(r-A-o)),y.style.fill=u,y.setAttribute("transform","scale(1,-1) translate(0,-"+String(r+(r-A))+")"),this.options.animation&&(y.innerHTML='<animate attributeName="height" from="0" to="'+String(A)+'" dur="'+this.options.duration+'s" fill="freeze" />'),y};Object.keys(this.options).length!==0&&this.options.order&&(this.options.order==="desc"?s.sort((p,g)=>p.value<g.value?1:p.value>g.value?-1:0):this.options.order==="asc"&&s.sort((p,g)=>p.value>g.value?1:p.value<g.value?-1:0)),s.forEach((p,g)=>{const A=p.value,u=p.color===""?"black":p.color,y=p.title,b=A/d*r,S=f(i,t,b,u),M=this.text(y,i+p.title.length,r+o+o*.75,"8px"),C=this.createGTag(),L=document.createElement("title");L.innerText=y+": "+p.value,L.id="accessible-svg-graphs"+this.randomID(),L.setAttribute("role","tooltip"),C.appendChild(L),C.setAttribute("aria-labelledby",L.id),C.appendChild(S),C.appendChild(M),x.appendChild(C),i+=t+o});const h=this.drawLine(0,r+o,c,r+o,"0.2px"),m=this.drawLine(o,0,o,r+o,"0.5px");if(this.options.yAxis){const p=this.yAxisValues(this.options.yAxis,d,r,c,o,8);x.appendChild(p)}x.appendChild(h),x.appendChild(m),this.addDataType(x,this.type),this.hook(a,x)},this.scatterplot=(s,a)=>{const e=s.map(h=>h.x),o=Math.floor(Math.max(...e)*1),n=100,d=s.map(h=>h.y),l=Math.max(...d),t=4,c=l>o?n:Math.floor(l/o*n),r=this.createSVG(0,0,n+t,c+2*t);r.classList.add("asg-graph");const i=(h,m,p,g,A,u,y)=>{const b=document.createElement("circle");let S=document.createElement("title");return S.innerText="x: "+String(p)+", y: "+String(g)+", "+u,S.setAttribute("role","tooltip"),b.setAttribute("cx",String(h)),b.setAttribute("cy",String(m)),b.setAttribute("r",String(A)),b.style.strokeWidth="0.2px",b.style.stroke="gray",b.style.fill=y,this.options.animation===!0&&(b.setAttribute("opacity","0"),b.innerHTML+='<animate attributeName="opacity" repeatCount="1" from="0" to="1" dur="'+this.options.duration+'s" fill="freeze" />'),b.appendChild(S),b};s.forEach(h=>{const m=h.x/o*(n-t)+t,p=(l-h.y)/l*c+t,g=h.title,A=this.options.radius?this.options.radius:1,u=i(m,p,h.x,h.y,A,g,h.color);r.appendChild(u)});const x=this.drawLine(t,c+t,n+t,c+t,"0.1px"),f=this.drawLine(t,0,t,c+t,"0.3px");if(this.options.yAxis){const h=this.yAxisValues(this.options.yAxis,l,c,n,t,2.2);r.appendChild(h)}if(this.options.xAxis){const h=this.xAxisValue(this.options.xAxis,c,t,3,null,o,n);r.appendChild(h)}r.appendChild(x),r.appendChild(f),this.addDataType(r,this.type),this.hook(a,r)},this.line=(s,a)=>{const e=s.map(u=>u.x),o=Math.max(...e),n=Math.min(...e),d=s.map(u=>u.y),l=Math.max(...d),t=4,c=e.length,r=c*t*2,i=r,x=Math.floor((r+t)/c),f=this.createSVG(0,0,r+2*t,i+2*t);f.classList.add("asg-graph"),s.sort((u,y)=>u.x>y.x?1:u.x<y.x?-1:0);const h=s.length;let m="";for(let u=0;u<h-1;u++){const y=u===0?2*t:x*u+t+t;let b=i-s[u].y/l*i+t;const S=x*(u+1)+t+t;let M=i-s[u+1].y/l*i+t;u===0?m="M "+Math.floor(y)+" "+Math.floor(b)+" L "+Math.floor(S)+" "+Math.floor(M):m+=" L "+Math.floor(S)+" "+Math.floor(M)}const p=this.options.fontSize?this.doPath(m,this.options.strikeWidth):this.doPath(m);f.appendChild(p);const g=this.drawLine(t,i+t,r+t,i+t,"0.2px"),A=this.drawLine(t,0,t,i+t,"0.2px");if(this.options.yAxis){const u=this.options.fontSize?this.yAxisValues(this.options.yAxis,l,i,r,t,this.options.fontSize):this.yAxisValues(this.options.yAxis,l,i,r,t,3);f.appendChild(u)}if(this.options.xAxis){const u=this.options.fontSize?this.xAxisValue(this.options.xAxis,i,t,this.options.fontSize,x):this.xAxisValue(this.options.xAxis,i,t,3,x);f.appendChild(u)}f.appendChild(g),f.appendChild(A),this.addDataType(f,this.type),this.hook(a,f)},this.createSVG=(s=0,a=0,e=64,o=64)=>{const n=document.createElement("svg");n.setAttribute("viewBox",s+" "+a+" "+e+" "+o),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("tabindex",String(0));const d=document.createElement("title");d.innerText=this.title,d.id="accessible-svg-graphs"+this.randomID(),n.appendChild(d);const l=document.createElement("desc");return l.innerText=this.description,l.id="accessible-svg-graphs"+this.randomID(),n.appendChild(l),n.setAttribute("aria-labelledby",d.id+" "+l.id),n},this.createGTag=(s=!0)=>{const a=document.createElement("g");return s&&a.setAttribute("tabindex","0"),a},this.randomID=()=>String(Math.floor(Math.random()*1e4)),this.drawLine=(s,a,e,o,n)=>{const d=document.createElement("line");return d.setAttribute("x1",String(s)),d.setAttribute("y1",String(a)),d.setAttribute("x2",String(e)),d.setAttribute("y2",String(o)),d.setAttribute("stroke","black"),d.setAttribute("stroke-width",n),d},this.text=(s,a,e,o)=>{const n=document.createElement("text");return n.innerText=s,n.setAttribute("x",String(a)),n.setAttribute("y",String(e)),n.style.fill="black",n.style.fontSize=o,n},this.doPath=(s,a=3)=>{const e=document.createElement("path");return e.setAttribute("d",s),this.options.animation===!0&&(e.classList.add("asg-path"),e.style.animation="asg-dash "+this.options.duration+"s ease-in-out forwards"),e.setAttribute("stroke","black"),e.setAttribute("stroke-width",String(a)+"px"),e.setAttribute("fill","transparent"),e},this.yAxisValues=(s,a,e,o,n,d)=>{const l=this.createGTag(!1);return s.forEach(t=>{const c=(a-t)/a*e+n;l.appendChild(this.text(String(t),0,c,String(d)+"px")),l.appendChild(this.drawLine(n,c,o+n,c,"0.1px"))}),l},this.xAxisValue=(s,a,e,o,n=null,d=null,l=null)=>{const t=this.createGTag(!1);return this.type==="scatterplot"&&d&&l?s.forEach(c=>{const r=c/d*l+e;t.appendChild(this.text(String(c),r,a+e+e*.75,String(o)+"px")),t.appendChild(this.drawLine(r,a+e,r,e,"0.1px"))}):this.type==="line"&&n&&s.forEach((c,r)=>{const i=r===0?2*e:n*r+2*e;t.appendChild(this.text(String(c),i,a+e+e*.75,String(o)+"px")),t.appendChild(this.drawLine(i,a+e,i,a+e+e/2,"0.1px"))}),t},this.addDataType=(s,a)=>s.setAttribute("data-type",a),this.hook=(s,a)=>{let e=document.querySelector(s);this.options.animation?this.observe(s,e,a):e&&(e.innerHTML+=a.outerHTML)},this.observe=(s,a,e)=>{const o=document.querySelectorAll(s),n=t=>{t.map(c=>{c.isIntersecting&&a&&!a.querySelector("svg")&&(a.innerHTML+=e.outerHTML)})},d={threshold:.99},l=new IntersectionObserver(n,d);o&&o.forEach(t=>{l.observe(t)})},this.type=v.type,this.title=v.title,this.description=v.description,this.data=v.data,this.injection=v.injection,this.options=v.options,this.type==="pie"||this.type=="donut"?this.pie(this.data,this.injection):this.type==="bar"?this.bar(this.data,this.injection):this.type==="scatterplot"?this.scatterplot(this.data,this.injection):this.type==="line"&&this.line(this.data,this.injection)}}exports.AccessibleSVG=AccessibleSVG;
