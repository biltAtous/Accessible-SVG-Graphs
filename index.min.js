"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AccessibleSVG=void 0;class AccessibleSVG{constructor(S){this.pie=(s,l)=>{const e=(a,x,f)=>{const p=document.createElement("circle");let A="25";p.setAttribute("r",A+"%"),p.setAttribute("cx","50%"),p.setAttribute("cy","50%"),A=16;const u=2*Math.PI*A,h=u*(a/100),y=h+","+u;return p.style.strokeDasharray=y,p.style.stroke=x,p.style.strokeDashoffset=String(f),{element:p,value:h}},o=a=>{let x=0;return a.forEach(f=>{x+=f.percentage}),x},i=a=>{let x="This pie is contains: ";return a.forEach(f=>{x+=String(f.percentage+"% for "+f.title+" and it's colored "+f.color+". ")}),x};if(o(s)!==100){console.log("The percentages for the pie must add up to exactly 100%.");return}const d=this.createSVG(0,0,64,64);d.classList.add("asg-graph");let n=0;const r=d.querySelector("desc");r.innerText+=i(s);const c=[];if(s.forEach(a=>{const x=e(a.percentage,a.color,-n),f=document.createElement("title");f.setAttribute("role","tooltip"),f.innerText=a.title+": "+a.percentage+"%",n+=x.value,x.element.appendChild(f),c.push(x.element)}),d.classList.add("asg-pie"),this.options.animation==!0){let a=e("0","white",-n+.53096491487338).element;a.classList.add("asg-reveal"),a.style.animation="rotate "+this.options.duration+"s ease-in-out forwards reverse",a.style.transform="rotate(0deg) scale(1,-1)",a.style.transformOrigin="center",c.push(a),this.observe(this.type)}c.forEach(a=>{d.appendChild(a)}),this.type==="donut"&&(d.innerHTML+='<circle r="35%" cx="50%" cy="50%" style="fill:white;"></circle>',d.style.border="none"),this.addDataType(d,this.type),this.hook(l,d)},this.bar=(s,l)=>{const e=s.length,o=10,i=s.map(u=>u.value),t=Math.max(...i),d=o,n=30,r=e*n+o*e+d*2,c=r;let a=o+d;const x=this.createSVG(0,0,r+2*o,c+2*o);x.classList.add("asg-graph");const f=(u,h,y,b)=>{const g=document.createElement("rect");return g.setAttribute("x",String(u)),g.setAttribute("width",String(h)),g.setAttribute("height",String(y)),g.setAttribute("y",String(c-y-o)),g.style.fill=b,g.setAttribute("transform","scale(1,-1) translate(0,-"+String(c+(c-y))+")"),this.options.animation&&(g.innerHTML='<animate attributeName="height" from="0" to="'+String(y)+'" dur="'+this.options.duration+'s" fill="freeze" />'),g};Object.keys(this.options).length!==0&&this.options.order&&(this.options.order==="desc"?s.sort((u,h)=>u.value<h.value?1:u.value>h.value?-1:0):this.options.order==="asc"&&s.sort((u,h)=>u.value>h.value?1:u.value<h.value?-1:0)),s.forEach((u,h)=>{const y=u.value,b=u.color===""?"black":u.color,g=u.title,m=y/t*c,v=f(a,n,m,b),T=this.text(g,a+u.title.length,c+o+o*.75,"8px"),C=this.createGTag(),L=document.createElement("title");L.innerText=g+": "+u.value,L.id="accessible-svg-graphs"+this.randomID(),L.setAttribute("role","tooltip"),C.appendChild(L),C.setAttribute("aria-labelledby",L.id),C.appendChild(v),C.appendChild(T),x.appendChild(C),a+=n+o});const p=this.drawLine(0,c+o,r,c+o,"0.2px"),A=this.drawLine(o,0,o,c+o,"0.5px");if(this.options.yAxis){const u=this.yAxisValues(this.options.yAxis,t,c,r,o,8);x.appendChild(u)}x.appendChild(p),x.appendChild(A),this.addDataType(x,this.type),this.hook(l,x)},this.scatterplot=(s,l)=>{const e=s.map(p=>p.x),o=Math.floor(Math.max(...e)*1),i=100,t=s.map(p=>p.y),d=Math.max(...t),n=4,r=d>o?i:Math.floor(d/o*i),c=this.createSVG(0,0,i+n,r+2*n);c.classList.add("asg-graph");const a=(p,A,u,h,y,b,g)=>{const m=document.createElement("circle");let v=document.createElement("title");return v.innerText="x: "+String(u)+", y: "+String(h)+", "+b,v.setAttribute("role","tooltip"),m.setAttribute("cx",String(p)),m.setAttribute("cy",String(A)),m.setAttribute("r",String(y)),m.style.strokeWidth="0.2px",m.style.stroke="gray",m.style.fill=g,this.options.animation===!0&&(m.setAttribute("opacity","0"),m.innerHTML+='<animate attributeName="opacity" repeatCount="1" from="0" to="1" dur="'+this.options.duration+'s" fill="freeze" />'),m.appendChild(v),m};s.forEach(p=>{const A=p.x/o*(i-n)+n,u=(d-p.y)/d*r+n,h=p.title,y=this.options.radius?this.options.radius:1,b=a(A,u,p.x,p.y,y,h,p.color);c.appendChild(b)});const x=this.drawLine(n,r+n,i+n,r+n,"0.1px"),f=this.drawLine(n,0,n,r+n,"0.3px");if(this.options.yAxis){const p=this.yAxisValues(this.options.yAxis,d,r,i,n,2.2);c.appendChild(p)}if(this.options.xAxis){const p=this.xAxisValue(this.options.xAxis,r,n,3,null,o,i);c.appendChild(p)}c.appendChild(x),c.appendChild(f),this.addDataType(c,this.type),this.hook(l,c)},this.line=(s,l)=>{const e=s.map(h=>h.x),o=s.map(h=>h.y),i=Math.max(...o),t=4,d=e.length,n=d*t*2,r=n,c=Math.floor((n+t)/d),a=this.createSVG(0,0,n+2*t,r+2*t);a.classList.add("asg-graph"),s.sort((h,y)=>h.x>y.x?1:h.x<y.x?-1:0);const x=s.length;let f="";for(let h=0;h<x-1;h++){const y=h===0?2*t:c*h+t+t;let b=r-s[h].y/i*r+t;const g=c*(h+1)+t+t;let m=r-s[h+1].y/i*r+t;h===0?f="M "+Math.floor(y)+" "+Math.floor(b)+" L "+Math.floor(g)+" "+Math.floor(m):f+=" L "+Math.floor(g)+" "+Math.floor(m)}const p=this.options.fontSize?this.doPath(f,this.options.strikeWidth):this.doPath(f);a.appendChild(p);const A=this.drawLine(t,r+t,n+t,r+t,"0.2px"),u=this.drawLine(t,0,t,r+t,"0.2px");if(this.options.yAxis){const h=this.options.fontSize?this.yAxisValues(this.options.yAxis,i,r,n,t,this.options.fontSize):this.yAxisValues(this.options.yAxis,i,r,n,t,3);a.appendChild(h)}if(this.options.xAxis){const h=this.options.fontSize?this.xAxisValue(this.options.xAxis,r,t,this.options.fontSize,c):this.xAxisValue(this.options.xAxis,r,t,3,c);a.appendChild(h)}a.appendChild(A),a.appendChild(u),this.addDataType(a,this.type),this.hook(l,a)},this.createSVG=(s=0,l=0,e=64,o=64)=>{const i=document.createElement("svg");i.setAttribute("viewBox",s+" "+l+" "+e+" "+o),i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("tabindex",String(0));const t=document.createElement("title");t.innerText=this.title,t.id="accessible-svg-graphs"+this.randomID(),i.appendChild(t);const d=document.createElement("desc");return d.innerText=this.description,d.id="accessible-svg-graphs"+this.randomID(),i.appendChild(d),i.setAttribute("aria-labelledby",t.id+" "+d.id),i},this.createGTag=(s=!0)=>{const l=document.createElement("g");return s&&l.setAttribute("tabindex","0"),l},this.randomID=()=>String(Math.floor(Math.random()*1e4)),this.drawLine=(s,l,e,o,i)=>{const t=document.createElement("line");return t.setAttribute("x1",String(s)),t.setAttribute("y1",String(l)),t.setAttribute("x2",String(e)),t.setAttribute("y2",String(o)),t.setAttribute("stroke","black"),t.setAttribute("stroke-width",i),t},this.text=(s,l,e,o)=>{const i=document.createElement("text");return i.innerText=s,i.setAttribute("x",String(l)),i.setAttribute("y",String(e)),i.style.fill="black",i.style.fontSize=o,i},this.doPath=(s,l=3)=>{const e=document.createElement("path");return e.setAttribute("d",s),this.options.animation===!0&&(e.classList.add("asg-path"),e.style.animation="asg-dash "+this.options.duration+"s ease-in-out forwards"),e.setAttribute("stroke","black"),e.setAttribute("stroke-width",String(l)+"px"),e.setAttribute("fill","transparent"),e},this.yAxisValues=(s,l,e,o,i,t)=>{const d=this.createGTag(!1);return s.forEach(n=>{const r=(l-n)/l*e+i;d.appendChild(this.text(String(n),0,r,String(t)+"px")),d.appendChild(this.drawLine(i,r,o+i,r,"0.1px"))}),d},this.xAxisValue=(s,l,e,o,i=null,t=null,d=null)=>{const n=this.createGTag(!1);return this.type==="scatterplot"&&t&&d?s.forEach(r=>{const c=r/t*d+e;n.appendChild(this.text(String(r),c,l+e+e*.75,String(o)+"px")),n.appendChild(this.drawLine(c,l+e,c,e,"0.1px"))}):this.type==="line"&&i&&s.forEach((r,c)=>{const a=c===0?2*e:i*c+2*e;n.appendChild(this.text(String(r),a,l+e+e*.75,String(o)+"px")),n.appendChild(this.drawLine(a,l+e,a,l+e+e/2,"0.1px"))}),n},this.addDataType=(s,l)=>s.setAttribute("data-type",l),this.hook=(s,l)=>{let e=document.querySelector(s);this.options.animation?this.observe(s,e,l):e&&(e.innerHTML+=l.outerHTML)},this.observe=(s,l,e)=>{const o=document.querySelectorAll(s),i=n=>{n.map(r=>{r.isIntersecting&&l&&!l.querySelector(".asg-graph")&&(l.innerHTML+=e.outerHTML)})},t={threshold:.8},d=new IntersectionObserver(i,t);o&&o.forEach(n=>{d.observe(n)})},this.type=S.type,this.title=S.title,this.description=S.description,this.data=S.data,this.injection=S.injection,this.options=S.options,this.type==="pie"||this.type=="donut"?this.pie(this.data,this.injection):this.type==="bar"?this.bar(this.data,this.injection):this.type==="scatterplot"?this.scatterplot(this.data,this.injection):this.type==="line"&&this.line(this.data,this.injection)}}exports.AccessibleSVG=AccessibleSVG;
