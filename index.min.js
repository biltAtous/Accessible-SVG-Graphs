"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AccessibleSVG=void 0;class AccessibleSVG{constructor(e){this.type=e.type,this.title=e.title,this.description=e.description,this.data=e.data,this.injection=e.injection,this.options=e.options,this.type==="pie"||this.type=="donut"?this.pie(this.data,this.injection):this.type==="bar"?this.bar(this.data,this.injection):this.type==="scatterplot"?this.scatterplot(this.data,this.injection):this.type==="line"?this.line(this.data,this.injection):this.type==="progress-bar"&&this.progressBar(this.data,this.injection)}pie(e,a){const i=(l,x,f)=>{const p=document.createElement("circle");let b="25";p.setAttribute("r",b+"%"),p.setAttribute("cx","50%"),p.setAttribute("cy","50%"),b=16;const u=2*Math.PI*b,d=u*(l/100),g=d+","+u;return p.style.strokeDasharray=g,p.style.stroke=x,p.style.strokeDashoffset=String(f),{element:p,value:d}},r=l=>{let x=0;return l.forEach(f=>{x+=f.percentage}),x},s=l=>{let x="This pie is contains: ";return l.forEach(f=>{x+=String(f.percentage+"% for "+f.title+" and it's colored "+f.color+". ")}),x};if(r(e)!==100){console.log("The percentages for the pie must add up to exactly 100%.");return}const h=this.createSVG(0,0,64,64);let n=0;const o=h.querySelector("desc");o.innerText+=s(e);const c=[];if(e.forEach(l=>{const x=i(l.percentage,l.color,-n),f=document.createElement("title");f.setAttribute("role","tooltip"),f.innerText=l.title+": "+l.percentage+"%",n+=x.value,x.element.appendChild(f),c.push(x.element)}),h.classList.add("asg-pie"),this.options.animation==!0){let l=i("0","white",-n+.53096491487338).element;l.classList.add("asg-reveal"),l.style.animation="rotate "+this.options.duration+"s ease-in-out forwards reverse",l.style.transform="rotate(0deg) scale(1,-1)",l.style.transformOrigin="center",c.push(l)}c.forEach(l=>{h.appendChild(l)}),this.type==="donut"&&(h.innerHTML+='<circle r="35%" cx="50%" cy="50%" style="fill:white;"></circle>',h.style.border="none"),this.addDataType(h,this.type),this.hook(a,h)}bar(e,a){const i=e.length,r=10,s=e.map(u=>u.value),t=Math.max(...s),h=r,n=30,o=i*n+r*i+h*2,c=o;let l=r+h;const x=this.createSVG(0,0,o+2*r,c+2*r),f=(u,d,g,A)=>{const y=document.createElement("rect");return y.setAttribute("x",String(u)),y.setAttribute("width",String(d)),y.setAttribute("height",String(g)),y.setAttribute("y",String(c-g-r)),y.style.fill=A,y.setAttribute("transform","scale(1,-1) translate(0,-"+String(c+(c-g))+")"),this.options.animation&&(y.innerHTML='<animate attributeName="height" from="0" to="'+String(g)+'" dur="'+this.options.duration+'s" fill="freeze" />'),y};Object.keys(this.options).length!==0&&this.options.order&&(this.options.order==="desc"?e.sort((u,d)=>u.value<d.value?1:u.value>d.value?-1:0):this.options.order==="asc"&&e.sort((u,d)=>u.value>d.value?1:u.value<d.value?-1:0)),e.forEach((u,d)=>{const g=u.value,A=u.color===""?"black":u.color,y=u.title,m=g/t*c,S=f(l,n,m,A),T=this.text(y,l+u.title.length,c+r+r*.75,"8px"),v=this.createGTag(),C=document.createElement("title");C.innerText=y+": "+u.value,C.id="accessible-svg-graphs"+this.randomID(),C.setAttribute("role","tooltip"),v.appendChild(C),v.setAttribute("aria-labelledby",C.id),v.appendChild(S),v.appendChild(T),x.appendChild(v),l+=n+r});const p=this.drawLine(0,c+r,o,c+r,"0.2px"),b=this.drawLine(r,0,r,c+r,"0.5px");if(this.options.yAxis){const u=this.yAxisValues(this.options.yAxis,t,c,o,r,8);x.appendChild(u)}x.appendChild(p),x.appendChild(b),this.addDataType(x,this.type),this.hook(a,x)}scatterplot(e,a){const i=e.map(p=>p.x),r=Math.floor(Math.max(...i)*1),s=100,t=e.map(p=>p.y),h=Math.max(...t),n=4,o=h>r?s:Math.floor(h/r*s),c=this.createSVG(0,0,s+n,o+2*n),l=(p,b,u,d,g,A,y)=>{const m=document.createElement("circle");let S=document.createElement("title");return S.innerText="x: "+String(u)+", y: "+String(d)+", "+A,S.setAttribute("role","tooltip"),m.setAttribute("cx",String(p)),m.setAttribute("cy",String(b)),m.setAttribute("r",String(g)),m.style.strokeWidth="0.2px",m.style.stroke="gray",m.style.fill=y,this.options.animation===!0&&(m.setAttribute("opacity","0"),m.innerHTML+='<animate attributeName="opacity" repeatCount="1" from="0" to="1" dur="'+this.options.duration+'s" fill="freeze" />'),m.appendChild(S),m};e.forEach(p=>{const b=p.x/r*(s-n)+n,u=(h-p.y)/h*o+n,d=p.title,g=this.options.radius?this.options.radius:1,A=l(b,u,p.x,p.y,g,d,p.color);c.appendChild(A)});const x=this.drawLine(n,o+n,s+n,o+n,"0.1px"),f=this.drawLine(n,0,n,o+n,"0.3px");if(this.options.yAxis){const p=this.yAxisValues(this.options.yAxis,h,o,s,n,2.2);c.appendChild(p)}if(this.options.xAxis){const p=this.xAxisValue(this.options.xAxis,o,n,3,0,r,s);c.appendChild(p)}c.appendChild(x),c.appendChild(f),this.addDataType(c,this.type),this.hook(a,c)}line(e,a){const i=e.map(d=>d.x),r=e.map(d=>d.y),s=Math.max(...r),t=4,h=i.length,n=h*t*2,o=n,c=Math.floor((n+t)/h),l=this.createSVG(0,0,n+2*t,o+2*t);e.sort((d,g)=>d.x>g.x?1:d.x<g.x?-1:0);const x=e.length;let f="";for(let d=0;d<x-1;d++){const g=d===0?2*t:c*d+t+t;let A=o-e[d].y/s*o+t;const y=c*(d+1)+t+t;let m=o-e[d+1].y/s*o+t;d===0?f="M "+Math.floor(g)+" "+Math.floor(A)+" L "+Math.floor(y)+" "+Math.floor(m):f+=" L "+Math.floor(y)+" "+Math.floor(m)}const p=this.options.fontSize?this.doPath(f,this.options.strikeWidth):this.doPath(f);l.appendChild(p);const b=this.drawLine(t,o+t,n+t,o+t,"0.2px"),u=this.drawLine(t,0,t,o+t,"0.2px");if(this.options.yAxis){const d=this.options.fontSize?this.yAxisValues(this.options.yAxis,s,o,n,t,this.options.fontSize):this.yAxisValues(this.options.yAxis,s,o,n,t,3);l.appendChild(d)}if(this.options.xAxis){const d=this.options.fontSize?this.xAxisValue(this.options.xAxis,o,t,this.options.fontSize,c):this.xAxisValue(this.options.xAxis,o,t,3,c);l.appendChild(d)}l.appendChild(b),l.appendChild(u),this.addDataType(l,this.type),this.hook(a,l)}progressBar(e,a){const i=e,r=100,s=10,t=this.createSVG(0,0,100,10),h=(l,x,f)=>{const p=document.createElement("rect");return p.setAttribute("x","0"),p.setAttribute("width",String(l)),p.setAttribute("height",String(s)),p.setAttribute("y","0"),p.style.fill=x,this.options.animation&&this.options.duration&&f&&(p.innerHTML='<animate attributeName="width" from="0" to="'+String(i)+'" dur="'+this.options.duration+'s" fill="freeze" />'),p},n=this.createGTag(!1);n.appendChild(h(r,this.options.outterColor,!1));const o=this.createGTag(!0),c=document.createElement("title");c.innerText="70%",o.appendChild(c),o.appendChild(h(i,this.options.innerColor,!0)),t.appendChild(n),t.appendChild(o),this.addDataType(t,this.type),this.hook(a,t)}createSVG(e=0,a=0,i=64,r=64){const s=document.createElement("svg");s.setAttribute("viewBox",e+" "+a+" "+i+" "+r),s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("tabindex",String(0)),s.classList.add("asg-graph");const t=document.createElement("title");t.innerText=this.title,t.id="accessible-svg-graphs"+this.randomID(),s.appendChild(t);const h=document.createElement("desc");return h.innerText=this.description,h.id="accessible-svg-graphs"+this.randomID(),s.appendChild(h),s.setAttribute("aria-labelledby",t.id+" "+h.id),s}createGTag(e=!0){const a=document.createElement("g");return e&&a.setAttribute("tabindex","0"),a}randomID(){return String(Math.floor(Math.random()*1e4))}drawLine(e,a,i,r,s){const t=document.createElement("line");return t.setAttribute("x1",String(e)),t.setAttribute("y1",String(a)),t.setAttribute("x2",String(i)),t.setAttribute("y2",String(r)),t.setAttribute("stroke","black"),t.setAttribute("stroke-width",s),t}text(e,a,i,r){const s=document.createElement("text");return s.innerText=e,s.setAttribute("x",String(a)),s.setAttribute("y",String(i)),s.style.fill="black",s.style.fontSize=r,s}doPath(e,a=3){const i=document.createElement("path");return i.setAttribute("d",e),this.options.animation===!0&&(i.classList.add("asg-path"),i.style.animation="asg-dash "+this.options.duration+"s ease-in-out forwards"),i.setAttribute("stroke","black"),i.setAttribute("stroke-width",String(a)+"px"),i.setAttribute("fill","transparent"),i}yAxisValues(e,a,i,r,s,t){const h=this.createGTag(!1);return e.forEach(n=>{const o=(a-n)/a*i+s;h.appendChild(this.text(String(n),0,o,String(t)+"px")),h.appendChild(this.drawLine(s,o,r+s,o,"0.1px"))}),h}xAxisValue(e,a,i,r,s,t,h){const n=this.createGTag(!1);return this.type==="scatterplot"&&t&&h?e.forEach(o=>{const c=o/t*h+i;n.appendChild(this.text(String(o),c,a+i+i*.75,String(r)+"px")),n.appendChild(this.drawLine(c,a+i,c,i,"0.1px"))}):this.type==="line"&&s&&e.forEach((o,c)=>{const l=c===0?2*i:s*c+2*i;n.appendChild(this.text(String(o),l,a+i+i*.75,String(r)+"px")),n.appendChild(this.drawLine(l,a+i,l,a+i+i/2,"0.1px"))}),n}addDataType(e,a){return e.setAttribute("data-type",a)}hook(e,a){let i=document.querySelector(e);this.options.animation?this.observe(e,i,a):i&&(i.innerHTML+=a.outerHTML)}observe(e,a,i){const r=document.querySelectorAll(e),s=n=>{n.map(o=>{o.isIntersecting&&a&&!a.querySelector(".asg-graph")&&(a.innerHTML+=i.outerHTML)})},t={threshold:.8},h=new IntersectionObserver(s,t);r&&r.forEach(n=>{h.observe(n)})}}exports.AccessibleSVG=AccessibleSVG;
