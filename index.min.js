"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AccessibleSVG=void 0;class AccessibleSVG{constructor(M){this.pie=(s,c)=>{const e=(a,f,m)=>{const l=document.createElement("circle");let S="25";l.setAttribute("r",S+"%"),l.setAttribute("cx","50%"),l.setAttribute("cy","50%"),S=16;const h=2*Math.PI*S,g=h*(a/100),A=g+","+h;return l.style.strokeDasharray=A,l.style.stroke=f,l.style.strokeDashoffset=String(m),{element:l,value:g}},o=a=>{let f=0;return a.forEach(m=>{f+=m.percentage}),f},i=a=>{let f="This pie is contains: ";return a.forEach(m=>{f+=String(m.percentage+"% for "+m.title+" and it's colored "+m.color+". ")}),f};if(o(s)!==100){console.log("The percentages for the pie must add up to exactly 100%.");return}const r=this.createSVG(0,0,64,64);let t=0;const d=r.querySelector("desc");d.innerText+=i(s);const n=[];if(s.forEach(a=>{const f=e(a.percentage,a.color,-t),m=document.createElement("title");m.setAttribute("role","tooltip"),m.innerText=a.title+": "+a.percentage+"%",t+=f.value,f.element.appendChild(m),n.push(f.element)}),this.options.animation==!0){let a=e("0","white",-t+.53096491487338).element;a.classList.add("asg-reveal"),a.style.animation="rotate "+this.options.duration+"s ease-in-out forwards reverse",n.push(a)}n.forEach(a=>{r.appendChild(a)}),r.classList.add("asg-pie"),this.type==="donut"&&(r.innerHTML+='<circle r="35%" cx="50%" cy="50%" style="fill:white;"></circle>',r.style.border="none");let x=document.querySelector(c);x&&(x.innerHTML+=r.outerHTML)},this.bar=(s,c)=>{const e=s.length,o=10,i=s.map(h=>h.value),u=Math.max(...i),r=o,t=30,d=e*t+o*e+r*2,n=d;let x=o+r;const a=this.createSVG(0,0,d+2*o,n+2*o),f=(h,g,A,p)=>{const y=document.createElement("rect");return y.setAttribute("x",String(h)),y.setAttribute("width",String(g)),y.setAttribute("height",String(A)),y.setAttribute("y",String(n-A-o)),y.style.fill=p,y.setAttribute("transform","scale(1,-1) translate(0,-"+String(n+(n-A))+")"),y.innerHTML='<animate attributeName="height" from="0" to="'+String(A)+'" dur="'+this.options.duration+'s" fill="freeze" />',y};Object.keys(this.options).length!==0&&this.options.order&&(this.options.order==="desc"?s.sort((h,g)=>h.value<g.value?1:h.value>g.value?-1:0):this.options.order==="asc"&&s.sort((h,g)=>h.value>g.value?1:h.value<g.value?-1:0)),s.forEach((h,g)=>{const A=h.value,p=h.color===""?"black":h.color,y=h.title,b=A/u*n,v=f(x,t,b,p),T=this.text(y,x+h.title.length,n+o+o*.75,"8px"),C=this.createGTag(),L=document.createElement("title");L.innerText=y+": "+h.value,L.id="accessible-svg-graphs"+this.randomID(),L.setAttribute("role","tooltip"),C.appendChild(L),C.setAttribute("aria-labelledby",L.id),C.appendChild(v),C.appendChild(T),a.appendChild(C),x+=t+o});const m=this.drawLine(0,n+o,d,n+o,"0.2px"),l=this.drawLine(o,0,o,n+o,"0.5px");if(this.options.yAxis){const h=this.yAxisValues(this.options.yAxis,u,n,d,o,8);a.appendChild(h)}a.appendChild(m),a.appendChild(l);let S=document.querySelector(c);S&&(S.innerHTML+=a.outerHTML)},this.scatterplot=(s,c)=>{const e=s.map(l=>l.x),o=Math.floor(Math.max(...e)*1),i=100,u=s.map(l=>l.y),r=Math.max(...u),t=4,d=r>o?i:Math.floor(r/o*i),n=this.createSVG(0,0,i+t,d+2*t),x=(l,S,h,g,A,p,y)=>{const b=document.createElement("circle");let v=document.createElement("title");return v.innerText="x: "+String(h)+", y: "+String(g)+", "+p,v.setAttribute("role","tooltip"),b.setAttribute("cx",String(l)),b.setAttribute("cy",String(S)),b.setAttribute("r",String(A)),b.style.strokeWidth="0.2px",b.style.stroke="gray",b.style.fill=y,this.options.animation===!0&&(b.setAttribute("opacity","0"),b.innerHTML+='<animate attributeName="opacity" repeatCount="1" from="0" to="1" dur="'+this.options.duration+'s" fill="freeze" />'),b.appendChild(v),b};s.forEach(l=>{const S=l.x/o*(i-t)+t,h=(r-l.y)/r*d+t,g=l.title,A=this.options.radius?this.options.radius:1,p=x(S,h,l.x,l.y,A,g,l.color);n.appendChild(p)});const a=this.drawLine(t,d+t,i+t,d+t,"0.1px"),f=this.drawLine(t,0,t,d+t,"0.3px");if(this.options.yAxis){const l=this.yAxisValues(this.options.yAxis,r,d,i,t,2.2);n.appendChild(l)}if(this.options.xAxis){const l=this.xAxisValue(this.options.xAxis,d,t,3,null,o,i);n.appendChild(l)}n.appendChild(a),n.appendChild(f);let m=document.querySelector(c);m&&(m.innerHTML+=n.outerHTML)},this.line=(s,c)=>{const e=s.map(p=>p.x),o=Math.max(...e),i=Math.min(...e),u=s.map(p=>p.y),r=Math.max(...u),t=4,d=e.length,n=d*t*2,x=n,a=Math.floor((n+t)/d),f=this.createSVG(0,0,n+2*t,x+2*t);s.sort((p,y)=>p.x>y.x?1:p.x<y.x?-1:0);const m=s.length;let l="";for(let p=0;p<m-1;p++){const y=p===0?2*t:a*p+t+t;let b=x-s[p].y/r*x+t;const v=a*(p+1)+t+t;let T=x-s[p+1].y/r*x+t;p===0?l="M "+Math.floor(y)+" "+Math.floor(b)+" L "+Math.floor(v)+" "+Math.floor(T):l+=" L "+Math.floor(v)+" "+Math.floor(T)}const S=this.options.fontSize?this.doPath(l,this.options.strikeWidth):this.doPath(l);f.appendChild(S);const h=this.drawLine(t,x+t,n+t,x+t,"0.2px"),g=this.drawLine(t,0,t,x+t,"0.2px");if(this.options.yAxis){const p=this.options.fontSize?this.yAxisValues(this.options.yAxis,r,x,n,t,this.options.fontSize):this.yAxisValues(this.options.yAxis,r,x,n,t,3);f.appendChild(p)}if(this.options.xAxis){const p=this.options.fontSize?this.xAxisValue(this.options.xAxis,x,t,this.options.fontSize,a):this.xAxisValue(this.options.xAxis,x,t,3,a);f.appendChild(p)}f.appendChild(h),f.appendChild(g);let A=document.querySelector(c);A&&(A.innerHTML+=f.outerHTML)},this.createSVG=(s=0,c=0,e=64,o=64)=>{const i=document.createElement("svg");i.setAttribute("viewBox",s+" "+c+" "+e+" "+o),i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("tabindex",String(0));const u=document.createElement("title");u.innerText=this.title,u.id="accessible-svg-graphs"+this.randomID(),i.appendChild(u);const r=document.createElement("desc");return r.innerText=this.description,r.id="accessible-svg-graphs"+this.randomID(),i.appendChild(r),i.setAttribute("aria-labelledby",u.id+" "+r.id),i},this.createGTag=(s=!0)=>{const c=document.createElement("g");return s&&c.setAttribute("tabindex","0"),c},this.randomID=()=>String(Math.floor(Math.random()*1e4)),this.drawLine=(s,c,e,o,i)=>{const u=document.createElement("line");return u.setAttribute("x1",String(s)),u.setAttribute("y1",String(c)),u.setAttribute("x2",String(e)),u.setAttribute("y2",String(o)),u.setAttribute("stroke","black"),u.setAttribute("stroke-width",i),u},this.text=(s,c,e,o)=>{const i=document.createElement("text");return i.innerText=s,i.setAttribute("x",String(c)),i.setAttribute("y",String(e)),i.style.fill="black",i.style.fontSize=o,i},this.doPath=(s,c=3)=>{const e=document.createElement("path");return e.setAttribute("d",s),this.options.animation===!0&&(e.classList.add("asg-path"),e.style.animation="asg-dash "+this.options.duration+"s ease-in-out forwards"),e.setAttribute("stroke","black"),e.setAttribute("stroke-width",String(c)+"px"),e.setAttribute("fill","transparent"),e},this.yAxisValues=(s,c,e,o,i,u)=>{const r=this.createGTag(!1);return s.forEach(t=>{const d=(c-t)/c*e+i;r.appendChild(this.text(String(t),0,d,String(u)+"px")),r.appendChild(this.drawLine(i,d,o+i,d,"0.1px"))}),r},this.xAxisValue=(s,c,e,o,i=null,u=null,r=null)=>{const t=this.createGTag(!1);return this.type==="scatterplot"&&u&&r?s.forEach(d=>{const n=d/u*r+e;t.appendChild(this.text(String(d),n,c+e+e*.75,String(o)+"px")),t.appendChild(this.drawLine(n,c+e,n,e,"0.1px"))}):this.type==="line"&&i&&s.forEach((d,n)=>{const x=n===0?2*e:i*n+2*e;t.appendChild(this.text(String(d),x,c+e+e*.75,String(o)+"px")),t.appendChild(this.drawLine(x,c+e,x,c+e+e/2,"0.1px"))}),t},this.type=M.type,this.title=M.title,this.description=M.description,this.data=M.data,this.injection=M.injection,this.options=M.options,this.type==="pie"||this.type=="donut"?this.pie(this.data,this.injection):this.type==="bar"?this.bar(this.data,this.injection):this.type==="scatterplot"?this.scatterplot(this.data,this.injection):this.type==="line"&&this.line(this.data,this.injection),console.log("Accessible SVG class has been properly instantiated!")}}exports.AccessibleSVG=AccessibleSVG;
