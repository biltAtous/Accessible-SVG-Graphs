"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AccessibleSVG=void 0;class AccessibleSVG{constructor(t){this.type=t.type,this.title=t.title,this.description=t.description,this.data=t.data,this.injection=t.injection,this.options=t.options,this.type==="pie"||this.type=="donut"?this.pie(this.data,this.injection):this.type==="bar"?this.bar(this.data,this.injection):this.type==="scatterplot"?this.scatterplot(this.data,this.injection):this.type==="line"&&this.line(this.data,this.injection)}pie(t,l){const s=(a,x,f)=>{const p=document.createElement("circle");let A="25";p.setAttribute("r",A+"%"),p.setAttribute("cx","50%"),p.setAttribute("cy","50%"),A=16;const u=2*Math.PI*A,h=u*(a/100),y=h+","+u;return p.style.strokeDasharray=y,p.style.stroke=x,p.style.strokeDashoffset=String(f),{element:p,value:h}},o=a=>{let x=0;return a.forEach(f=>{x+=f.percentage}),x},i=a=>{let x="This pie is contains: ";return a.forEach(f=>{x+=String(f.percentage+"% for "+f.title+" and it's colored "+f.color+". ")}),x};if(o(t)!==100){console.log("The percentages for the pie must add up to exactly 100%.");return}const d=this.createSVG(0,0,64,64);d.classList.add("asg-graph");let n=0;const r=d.querySelector("desc");r.innerText+=i(t);const c=[];if(t.forEach(a=>{const x=s(a.percentage,a.color,-n),f=document.createElement("title");f.setAttribute("role","tooltip"),f.innerText=a.title+": "+a.percentage+"%",n+=x.value,x.element.appendChild(f),c.push(x.element)}),d.classList.add("asg-pie"),this.options.animation==!0){let a=s("0","white",-n+.53096491487338).element;a.classList.add("asg-reveal"),a.style.animation="rotate "+this.options.duration+"s ease-in-out forwards reverse",a.style.transform="rotate(0deg) scale(1,-1)",a.style.transformOrigin="center",c.push(a)}c.forEach(a=>{d.appendChild(a)}),this.type==="donut"&&(d.innerHTML+='<circle r="35%" cx="50%" cy="50%" style="fill:white;"></circle>',d.style.border="none"),this.addDataType(d,this.type),this.hook(l,d)}bar(t,l){const s=t.length,o=10,i=t.map(u=>u.value),e=Math.max(...i),d=o,n=30,r=s*n+o*s+d*2,c=r;let a=o+d;const x=this.createSVG(0,0,r+2*o,c+2*o);x.classList.add("asg-graph");const f=(u,h,y,b)=>{const g=document.createElement("rect");return g.setAttribute("x",String(u)),g.setAttribute("width",String(h)),g.setAttribute("height",String(y)),g.setAttribute("y",String(c-y-o)),g.style.fill=b,g.setAttribute("transform","scale(1,-1) translate(0,-"+String(c+(c-y))+")"),this.options.animation&&(g.innerHTML='<animate attributeName="height" from="0" to="'+String(y)+'" dur="'+this.options.duration+'s" fill="freeze" />'),g};Object.keys(this.options).length!==0&&this.options.order&&(this.options.order==="desc"?t.sort((u,h)=>u.value<h.value?1:u.value>h.value?-1:0):this.options.order==="asc"&&t.sort((u,h)=>u.value>h.value?1:u.value<h.value?-1:0)),t.forEach((u,h)=>{const y=u.value,b=u.color===""?"black":u.color,g=u.title,m=y/e*c,S=f(a,n,m,b),L=this.text(g,a+u.title.length,c+o+o*.75,"8px"),v=this.createGTag(),C=document.createElement("title");C.innerText=g+": "+u.value,C.id="accessible-svg-graphs"+this.randomID(),C.setAttribute("role","tooltip"),v.appendChild(C),v.setAttribute("aria-labelledby",C.id),v.appendChild(S),v.appendChild(L),x.appendChild(v),a+=n+o});const p=this.drawLine(0,c+o,r,c+o,"0.2px"),A=this.drawLine(o,0,o,c+o,"0.5px");if(this.options.yAxis){const u=this.yAxisValues(this.options.yAxis,e,c,r,o,8);x.appendChild(u)}x.appendChild(p),x.appendChild(A),this.addDataType(x,this.type),this.hook(l,x)}scatterplot(t,l){const s=t.map(p=>p.x),o=Math.floor(Math.max(...s)*1),i=100,e=t.map(p=>p.y),d=Math.max(...e),n=4,r=d>o?i:Math.floor(d/o*i),c=this.createSVG(0,0,i+n,r+2*n);c.classList.add("asg-graph");const a=(p,A,u,h,y,b,g)=>{const m=document.createElement("circle");let S=document.createElement("title");return S.innerText="x: "+String(u)+", y: "+String(h)+", "+b,S.setAttribute("role","tooltip"),m.setAttribute("cx",String(p)),m.setAttribute("cy",String(A)),m.setAttribute("r",String(y)),m.style.strokeWidth="0.2px",m.style.stroke="gray",m.style.fill=g,this.options.animation===!0&&(m.setAttribute("opacity","0"),m.innerHTML+='<animate attributeName="opacity" repeatCount="1" from="0" to="1" dur="'+this.options.duration+'s" fill="freeze" />'),m.appendChild(S),m};t.forEach(p=>{const A=p.x/o*(i-n)+n,u=(d-p.y)/d*r+n,h=p.title,y=this.options.radius?this.options.radius:1,b=a(A,u,p.x,p.y,y,h,p.color);c.appendChild(b)});const x=this.drawLine(n,r+n,i+n,r+n,"0.1px"),f=this.drawLine(n,0,n,r+n,"0.3px");if(this.options.yAxis){const p=this.yAxisValues(this.options.yAxis,d,r,i,n,2.2);c.appendChild(p)}if(this.options.xAxis){const p=this.xAxisValue(this.options.xAxis,r,n,3,0,o,i);c.appendChild(p)}c.appendChild(x),c.appendChild(f),this.addDataType(c,this.type),this.hook(l,c)}line(t,l){const s=t.map(h=>h.x),o=t.map(h=>h.y),i=Math.max(...o),e=4,d=s.length,n=d*e*2,r=n,c=Math.floor((n+e)/d),a=this.createSVG(0,0,n+2*e,r+2*e);a.classList.add("asg-graph"),t.sort((h,y)=>h.x>y.x?1:h.x<y.x?-1:0);const x=t.length;let f="";for(let h=0;h<x-1;h++){const y=h===0?2*e:c*h+e+e;let b=r-t[h].y/i*r+e;const g=c*(h+1)+e+e;let m=r-t[h+1].y/i*r+e;h===0?f="M "+Math.floor(y)+" "+Math.floor(b)+" L "+Math.floor(g)+" "+Math.floor(m):f+=" L "+Math.floor(g)+" "+Math.floor(m)}const p=this.options.fontSize?this.doPath(f,this.options.strikeWidth):this.doPath(f);a.appendChild(p);const A=this.drawLine(e,r+e,n+e,r+e,"0.2px"),u=this.drawLine(e,0,e,r+e,"0.2px");if(this.options.yAxis){const h=this.options.fontSize?this.yAxisValues(this.options.yAxis,i,r,n,e,this.options.fontSize):this.yAxisValues(this.options.yAxis,i,r,n,e,3);a.appendChild(h)}if(this.options.xAxis){const h=this.options.fontSize?this.xAxisValue(this.options.xAxis,r,e,this.options.fontSize,c):this.xAxisValue(this.options.xAxis,r,e,3,c);a.appendChild(h)}a.appendChild(A),a.appendChild(u),this.addDataType(a,this.type),this.hook(l,a)}createSVG(t=0,l=0,s=64,o=64){const i=document.createElement("svg");i.setAttribute("viewBox",t+" "+l+" "+s+" "+o),i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("tabindex",String(0));const e=document.createElement("title");e.innerText=this.title,e.id="accessible-svg-graphs"+this.randomID(),i.appendChild(e);const d=document.createElement("desc");return d.innerText=this.description,d.id="accessible-svg-graphs"+this.randomID(),i.appendChild(d),i.setAttribute("aria-labelledby",e.id+" "+d.id),i}createGTag(t=!0){const l=document.createElement("g");return t&&l.setAttribute("tabindex","0"),l}randomID(){return String(Math.floor(Math.random()*1e4))}drawLine(t,l,s,o,i){const e=document.createElement("line");return e.setAttribute("x1",String(t)),e.setAttribute("y1",String(l)),e.setAttribute("x2",String(s)),e.setAttribute("y2",String(o)),e.setAttribute("stroke","black"),e.setAttribute("stroke-width",i),e}text(t,l,s,o){const i=document.createElement("text");return i.innerText=t,i.setAttribute("x",String(l)),i.setAttribute("y",String(s)),i.style.fill="black",i.style.fontSize=o,i}doPath(t,l=3){const s=document.createElement("path");return s.setAttribute("d",t),this.options.animation===!0&&(s.classList.add("asg-path"),s.style.animation="asg-dash "+this.options.duration+"s ease-in-out forwards"),s.setAttribute("stroke","black"),s.setAttribute("stroke-width",String(l)+"px"),s.setAttribute("fill","transparent"),s}yAxisValues(t,l,s,o,i,e){const d=this.createGTag(!1);return t.forEach(n=>{const r=(l-n)/l*s+i;d.appendChild(this.text(String(n),0,r,String(e)+"px")),d.appendChild(this.drawLine(i,r,o+i,r,"0.1px"))}),d}xAxisValue(t,l,s,o,i,e,d){const n=this.createGTag(!1);return this.type==="scatterplot"&&e&&d?t.forEach(r=>{const c=r/e*d+s;n.appendChild(this.text(String(r),c,l+s+s*.75,String(o)+"px")),n.appendChild(this.drawLine(c,l+s,c,s,"0.1px"))}):this.type==="line"&&i&&t.forEach((r,c)=>{const a=c===0?2*s:i*c+2*s;n.appendChild(this.text(String(r),a,l+s+s*.75,String(o)+"px")),n.appendChild(this.drawLine(a,l+s,a,l+s+s/2,"0.1px"))}),n}addDataType(t,l){return t.setAttribute("data-type",l)}hook(t,l){let s=document.querySelector(t);this.options.animation?this.observe(t,s,l):s&&(s.innerHTML+=l.outerHTML)}observe(t,l,s){const o=document.querySelectorAll(t),i=n=>{n.map(r=>{r.isIntersecting&&l&&!l.querySelector(".asg-graph")&&(l.innerHTML+=s.outerHTML)})},e={threshold:.8},d=new IntersectionObserver(i,e);o&&o.forEach(n=>{d.observe(n)})}}exports.AccessibleSVG=AccessibleSVG;
